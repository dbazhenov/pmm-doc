


    <title>Configuring MySQL for Best Results &mdash; Percona Monitoring and Management Documentation</title>
    
  <head>
    
    
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Percona Monitoring and Management Documentation" href="index.html" /> 
  </head>
  <body>
    <div class="container">  

    <div class="document row">
      <div class="documentwrapper col-md-9 col-md-push-3">
    <div class="related row">
      
      <ul class="nav nav-pills">
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">Percona Monitoring and Management Documentation</a></li> 
      </ul>
    </div>
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuring-mysql-for-best-results">
<span id="conf-mysql"></span><h1>Configuring MySQL for Best Results<a class="headerlink" href="#configuring-mysql-for-best-results" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2><a class="reference external" href="pmm.conf-mysql.settings.dashboard">Settings for Dashboards</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Not all dashboards in Metrics Monitor are available by default for all MySQL
variants and configurations: Oracle&#8216;s MySQL, Percona Server. or MariaDB.
Some graphs require Percona Server, specialized plugins, or additional
configuration.</p>
<p>Collecting metrics and statistics for graphs increases overhead.  You can keep
collecting and graphing low-overhead metrics all the time, and enable
high-overhead metrics only when troubleshooting problems.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt>More information about PMM dashboards</dt>
<dd><a class="reference internal" href="metrics-monitor (копия).html#pmm-metrics-monitor"><span class="std std-ref">Metrics Monitor</span></a></dd>
</dl>
</div>
<div class="section" id="id2">
<h3><a class="reference external" href="pmm.conf-mysql.mysql-innodb.metrics">MySQL InnoDB Metrics</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>InnoDB metrics provide detailed insight about InnoDB operation.  Although you
can select to capture only specific counters, their overhead is low even when
they all are enabled all the time.  To enable all InnoDB metrics, set the
global variable <code class="xref std std-option docutils literal"><span class="pre">innodb_monitor_enable</span></code> to <code class="docutils literal"><span class="pre">all</span></code>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">innodb_monitor_enable</span><span class="o">=</span><span class="k">all</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt>MySQL Documentation: <code class="xref std std-option docutils literal"><span class="pre">innodb_monitor_enable</span></code> variable</dt>
<dd><a class="reference external" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_monitor_enable">https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_monitor_enable</a></dd>
</dl>
</div>
</div>
<div class="section" id="id3">
<h3><a class="reference external" href="pmm.conf-mysql.user-statistics">MySQL User Statistics</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>User statistics is a feature of Percona Server and MariaDB.  It provides
information about user activity, individual table and index access.  In some
cases, collecting user statistics can lead to high overhead, so use this feature
sparingly.</p>
<p>To enable user statistics, set the <code class="xref std std-option docutils literal"><span class="pre">userstat</span></code> variable to <code class="docutils literal"><span class="pre">1</span></code>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt>Percona Server Documentation: <code class="xref std std-option docutils literal"><span class="pre">userstat</span></code></dt>
<dd><a class="reference external" href="https://www.percona.com/doc/percona-server/5.7/diagnostics/user_stats.html#userstat">https://www.percona.com/doc/percona-server/5.7/diagnostics/user_stats.html#userstat</a></dd>
<dt>MySQL Documentation</dt>
<dd><a class="reference external" href="https://dev.mysql.com/doc/refman/5.7/en/set-variable.html">Setting variables</a></dd>
</dl>
</div>
</div>
<div class="section" id="id4">
<h3><a class="reference external" href="pmm.conf-mysql.query-response-time">Percona Server Query Response Time Distribution</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Query response time distribution is a feature available in Percona Server.  It
provides information about changes in query response time for different groups
of queries, often allowing to spot performance problems before they lead to
serious issues.</p>
<p>To enable collection of query response time:</p>
<ol class="arabic">
<li><p class="first">Install the <code class="code docutils literal"><span class="pre">QUERY_RESPONSE_TIME</span></code> plugins:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSTALL</span> <span class="n">PLUGIN</span> <span class="n">QUERY_RESPONSE_TIME_AUDIT</span> <span class="n">SONAME</span> <span class="s1">&#39;query_response_time.so&#39;</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSTALL</span> <span class="n">PLUGIN</span> <span class="n">QUERY_RESPONSE_TIME</span> <span class="n">SONAME</span> <span class="s1">&#39;query_response_time.so&#39;</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSTALL</span> <span class="n">PLUGIN</span> <span class="n">QUERY_RESPONSE_TIME_READ</span> <span class="n">SONAME</span> <span class="s1">&#39;query_response_time.so&#39;</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSTALL</span> <span class="n">PLUGIN</span> <span class="n">QUERY_RESPONSE_TIME_WRITE</span> <span class="n">SONAME</span> <span class="s1">&#39;query_response_time.so&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Set the global varible <code class="xref std std-option docutils literal"><span class="pre">query_response_time_stats</span></code> to <code class="docutils literal"><span class="pre">ON</span></code>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">query_response_time_stats</span><span class="o">=</span><span class="k">ON</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition-related-information-percona-server-documentation admonition">
<p class="first admonition-title">Related Information: Percona Server Documentation</p>
<ul class="last simple">
<li><code class="xref std std-option docutils literal"><span class="pre">query_response_time_stats</span></code>: <a class="reference external" href="https://www.percona.com/doc/percona-server/5.7/diagnostics/response_time_distribution.html#query_response_time_stats">https://www.percona.com/doc/percona-server/5.7/diagnostics/response_time_distribution.html#query_response_time_stats</a></li>
<li>Response time distribution: <a class="reference external" href="https://www.percona.com/doc/percona-server/5.7/diagnostics/response_time_distribution.html#installing-the-plugins">https://www.percona.com/doc/percona-server/5.7/diagnostics/response_time_distribution.html#installing-the-plugins</a></li>
</ul>
</div>
</div>
</div>
<div class="section" id="id5">
<h2><a class="reference external" href="pmm.conf-mysql.executing.custom.queries">Executing Custom Queries</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Starting from the version 1.15.0, PMM provides user the ability to take a SQL
<code class="docutils literal"><span class="pre">SELECT</span></code> statement and turn the result set into metric series in PMM. The
queries are executed at the LOW RESOLUTION level, which by default is every 60
seconds. A key advantage is that you can extend PMM to profile metrics unique
to your environment (see users table example below), or to introduce support
for a table that isn&#8217;t part of PMM yet. This feature is on by default and only
requires that you edit the configuration file and use vaild YAML syntax. The
default configuration file location is
<code class="docutils literal"><span class="pre">/usr/local/percona/pmm-client/queries-mysqld.yml</span></code>.</p>
<div class="section" id="example-application-users-table">
<h3>Example - Application users table<a class="headerlink" href="#example-application-users-table" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;re going to take a users table of upvotes and downvotes and turn this into
two metric series, with a set of labels. Labels can also store a value. You can
filter against labels.</p>
<div class="section" id="browsing-metrics-series-using-advanced-data-exploration-dashboard">
<h4>Browsing metrics series using Advanced Data Exploration Dashboard<a class="headerlink" href="#browsing-metrics-series-using-advanced-data-exploration-dashboard" title="Permalink to this headline">¶</a></h4>
<p>Lets look at the output so we understand the goal - take data from a MySQL
table and store in PMM, then display as a metric series. Using the Advanced
Data Exploration Dashboard you can review your metric series.</p>
</div>
<div class="section" id="mysql-table">
<h4>MySQL table<a class="headerlink" href="#mysql-table" title="Permalink to this headline">¶</a></h4>
<p>Lets assume you have the following users table that includes true/false, string,
and integer types.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>SELECT * FROM <span class="sb">`</span>users<span class="sb">`</span>
+----+------+--------------+-----------+------------+-----------+---------------------+--------+---------+-----------+
<span class="p">|</span> id <span class="p">|</span> app  <span class="p">|</span> user_type    <span class="p">|</span> last_name <span class="p">|</span> first_name <span class="p">|</span> logged_in <span class="p">|</span> active_subscription <span class="p">|</span> banned <span class="p">|</span> upvotes <span class="p">|</span> downvotes <span class="p">|</span>
+----+------+--------------+-----------+------------+-----------+---------------------+--------+---------+-----------+
<span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> app2 <span class="p">|</span> unprivileged <span class="p">|</span> Marley    <span class="p">|</span> Bob        <span class="p">|</span>         <span class="m">1</span> <span class="p">|</span>                   <span class="m">1</span> <span class="p">|</span>      <span class="m">0</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>        <span class="m">25</span> <span class="p">|</span>
<span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> app3 <span class="p">|</span> moderator    <span class="p">|</span> Young     <span class="p">|</span> Neil       <span class="p">|</span>         <span class="m">1</span> <span class="p">|</span>                   <span class="m">1</span> <span class="p">|</span>      <span class="m">1</span> <span class="p">|</span>     <span class="m">150</span> <span class="p">|</span>        <span class="m">10</span> <span class="p">|</span>
<span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> app4 <span class="p">|</span> unprivileged <span class="p">|</span> OConnor   <span class="p">|</span> Sinead     <span class="p">|</span>         <span class="m">1</span> <span class="p">|</span>                   <span class="m">1</span> <span class="p">|</span>      <span class="m">0</span> <span class="p">|</span>      <span class="m">25</span> <span class="p">|</span>        <span class="m">50</span> <span class="p">|</span>
<span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> app1 <span class="p">|</span> unprivileged <span class="p">|</span> Yorke     <span class="p">|</span> Thom       <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>                   <span class="m">1</span> <span class="p">|</span>      <span class="m">0</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>       <span class="m">100</span> <span class="p">|</span>
<span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> app5 <span class="p">|</span> admin        <span class="p">|</span> Buckley   <span class="p">|</span> Jeff       <span class="p">|</span>         <span class="m">1</span> <span class="p">|</span>                   <span class="m">1</span> <span class="p">|</span>      <span class="m">0</span> <span class="p">|</span>     <span class="m">175</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>
+----+------+--------------+-----------+------------+-----------+---------------------+--------+---------+-----------+
</pre></div>
</div>
</div>
<div class="section" id="explaining-the-yaml-syntax">
<h4>Explaining the YAML syntax<a class="headerlink" href="#explaining-the-yaml-syntax" title="Permalink to this headline">¶</a></h4>
<p>We&#8217;ll go through a simple example and mention what&#8217;s required for each line. The
metric series is constructed based on the first line and appends the column name
to form metric series. Therefore the number of metric series per table will be
the count of columns that are of type <code class="docutils literal"><span class="pre">GAUGE</span></code> or <code class="docutils literal"><span class="pre">COUNTER</span></code>. This metric
series will be called <code class="docutils literal"><span class="pre">app1_users_metrics_downvotes</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>app1_users_metrics:                                 <span class="c1">## leading section of your metric series.</span>
  query: <span class="s2">&quot;SELECT * FROM app1.users&quot;</span>                 <span class="c1">## Your query. Don&#39;t forget the schema name.</span>
  metrics:                                          <span class="c1">## Required line to start the list of metric items</span>
    - downvotes:                                    <span class="c1">## Name of the column returned by the query. Will be appended to the metric series.</span>
        usage: <span class="s2">&quot;COUNTER&quot;</span>                            <span class="c1">## Column value type.  COUNTER will make this a metric series.</span>
        description: <span class="s2">&quot;Number of upvotes&quot;</span>            <span class="c1">## Helpful description of the column.</span>
</pre></div>
</div>
</div>
<div class="section" id="full-queries-mysqld-yml-example">
<h4>Full queries-mysqld.yml example<a class="headerlink" href="#full-queries-mysqld-yml-example" title="Permalink to this headline">¶</a></h4>
<p>Each column in the <code class="docutils literal"><span class="pre">SELECT</span></code> is named in this example, but that isn&#8217;t required,
you can use a <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">*</span></code> as well. Notice the format of schema.table for the
query is included.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>---
app1_users_metrics:
  query: <span class="s2">&quot;SELECT app,first_name,last_name,logged_in,active_subscription,banned,upvotes,downvotes FROM app1.users&quot;</span>
  metrics:
    - app:
        usage: <span class="s2">&quot;LABEL&quot;</span>
        description: <span class="s2">&quot;Name of the Application&quot;</span>
    - user_type:
        usage: <span class="s2">&quot;LABEL&quot;</span>
        description: <span class="s2">&quot;User&#39;s privilege level within the Application&quot;</span>
    - first_name:
        usage: <span class="s2">&quot;LABEL&quot;</span>
        description: <span class="s2">&quot;User&#39;s First Name&quot;</span>
    - last_name:
        usage: <span class="s2">&quot;LABEL&quot;</span>
        description: <span class="s2">&quot;User&#39;s Last Name&quot;</span>
    - logged_in:
        usage: <span class="s2">&quot;LABEL&quot;</span>
        description: <span class="s2">&quot;User&#39;s logged in or out status&quot;</span>
    - active_subscription:
        usage: <span class="s2">&quot;LABEL&quot;</span>
        description: <span class="s2">&quot;Whether User has an active subscription or not&quot;</span>
    - banned:
        usage: <span class="s2">&quot;LABEL&quot;</span>
        description: <span class="s2">&quot;Whether user is banned or not&quot;</span>
    - upvotes:
        usage: <span class="s2">&quot;COUNTER&quot;</span>
        description: <span class="s2">&quot;Count of upvotes the User has earned. Upvotes once granted cannot be revoked, so the number can only increase.&quot;</span>
    - downvotes:
        usage: <span class="s2">&quot;GAUGE&quot;</span>
        description: <span class="s2">&quot;Count of downvotes the User has earned. Downvotes can be revoked so the number can increase as well as decrease.&quot;</span>
...
</pre></div>
</div>
<p>This custom query description should be placed in a YAML file
(<code class="docutils literal"><span class="pre">queries-mysqld.yml</span></code> by default) on the corresponding server with MySQL.</p>
<p>In order to modify the location of the queries file, for example if you have multiple mysqld instances per server, you need to explicitly identify to the PMM Server MySQL with the <code class="docutils literal"><span class="pre">pmm-admin</span> <span class="pre">add</span></code> command after the double dash:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pmm</span><span class="o">-</span><span class="n">admin</span> <span class="n">add</span> <span class="n">mysql</span><span class="p">:</span><span class="n">metrics</span> <span class="o">...</span> <span class="o">--</span> <span class="o">--</span><span class="n">queries</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">percona</span><span class="o">/</span><span class="n">pmm</span><span class="o">-</span><span class="n">client</span><span class="o">/</span><span class="n">query</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
    <div class="related row">
      
      <ul class="nav nav-pills">
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">Percona Monitoring and Management Documentation</a></li> 
      </ul>
    </div>
      </div>
      <div class="sphinxsidebar  col-md-3 col-md-pull-9">
        <div class="sphinxsidebarwrapper">
  
          {@ product_logo @}          

          {@ product_pdf_download @}
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring MySQL for Best Results</a><ul>
<li><a class="reference internal" href="#id1">Settings for Dashboards</a><ul>
<li><a class="reference internal" href="#id2">MySQL InnoDB Metrics</a></li>
<li><a class="reference internal" href="#id3">MySQL User Statistics</a></li>
<li><a class="reference internal" href="#id4">Percona Server Query Response Time Distribution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">Executing Custom Queries</a><ul>
<li><a class="reference internal" href="#example-application-users-table">Example - Application users table</a><ul>
<li><a class="reference internal" href="#browsing-metrics-series-using-advanced-data-exploration-dashboard">Browsing metrics series using Advanced Data Exploration Dashboard</a></li>
<li><a class="reference internal" href="#mysql-table">MySQL table</a></li>
<li><a class="reference internal" href="#explaining-the-yaml-syntax">Explaining the YAML syntax</a></li>
<li><a class="reference internal" href="#full-queries-mysqld-yml-example">Full queries-mysqld.yml example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">jQuery(document).ready(function(){ jQuery('#searchbox').show(0); });</script>
          {@ product_series @}
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <!-- div class="footer">
        &copy; Copyright Percona LLC and/or its affiliates 2009-2019.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.
    </div -->
  </div>
  </body>
